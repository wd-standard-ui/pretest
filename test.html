<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Connectivity Test â€” Exam System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style> body{ font-family: Kanit, system-ui, sans-serif; } .card{ @apply bg-white rounded-2xl shadow p-4; } </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <main class="max-w-4xl mx-auto p-6 space-y-4">
    <h1 class="text-xl font-bold">ðŸ”Œ Connectivity Test</h1>

    <section class="card">
      <label class="text-sm text-gray-600">SCRIPT_URL</label>
      <input id="inpUrl" class="border rounded-lg px-3 py-2 w-full" placeholder="https://script.google.com/macros/s/.../exec">
      <div class="flex flex-wrap gap-2 mt-3">
        <button id="btnPing" class="px-4 py-2 rounded-xl bg-blue-600 text-white">à¸—à¸”à¸ªà¸­à¸š listOpenExams (GET)</button>
        <button id="btnSetup" class="px-4 py-2 rounded-xl border">setupSheets (POST)</button>
        <button id="btnSeed" class="px-4 py-2 rounded-xl border">seedSamples (POST)</button>
        <button id="btnJsonp" class="px-4 py-2 rounded-xl border">listOpenExams (JSONP)</button>
      </div>
    </section>

    <section class="card">
      <h2 class="font-semibold mb-2">à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œ</h2>
      <pre id="out" class="text-xs bg-gray-50 p-3 rounded-lg overflow-auto max-h-[50vh]"></pre>
    </section>
  </main>

  <script type="module">
    const out = document.getElementById('out');
    const urlEl = document.getElementById('inpUrl');
    const $ = s => document.querySelector(s);
    function log(obj){ out.textContent = typeof obj==='string'? obj : JSON.stringify(obj, null, 2); }

    async function apiGet(base, action, params={}){
      const u = new URL(base);
      u.searchParams.set('action', action);
      Object.entries(params).forEach(([k,v])=>u.searchParams.set(k,v));
      const res = await fetch(u.toString(), { method:'GET' });
      return res.json();
    }
    async function apiPost(base, action, body={}){
      const u = new URL(base); u.searchParams.set('action', action);
      const form = new URLSearchParams();
      Object.entries(body).forEach(([k,v])=>form.set(k, typeof v==='object'? JSON.stringify(v): String(v)));
      const res = await fetch(u.toString(), { method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded;charset=UTF-8'}, body: form.toString() });
      return res.json();
    }
    function apiJsonp(base, action, params={}){
      return new Promise((resolve, reject)=>{
        const cb = 'cb_'+Math.random().toString(36).slice(2);
        params.callback = cb;
        const u = new URL(base);
        u.searchParams.set('action', action);
        Object.entries(params).forEach(([k,v])=>u.searchParams.set(k,v));
        window[cb] = (data)=>{ resolve(data); cleanup(); };
        const s = document.createElement('script');
        s.src = u.toString();
        s.onerror = (e)=>{ reject(e); cleanup(); };
        document.head.appendChild(s);
        function cleanup(){ delete window[cb]; s.remove(); }
      });
    }

    document.getElementById('btnPing').onclick = async ()=>{
      try{ log(await apiGet(urlEl.value, 'listOpenExams')); }catch(e){ log(String(e)); }
    };
    document.getElementById('btnSetup').onclick = async ()=>{
      try{ log(await apiPost(urlEl.value, 'setupSheets')); }catch(e){ log(String(e)); }
    };
    document.getElementById('btnSeed').onclick = async ()=>{
      try{ log(await apiPost(urlEl.value, 'seedSamples')); }catch(e){ log(String(e)); }
    };
    document.getElementById('btnJsonp').onclick = async ()=>{
      try{ log(await apiJsonp(urlEl.value, 'listOpenExams')); }catch(e){ log(String(e)); }
    };
  </script>
</body>
</html>
